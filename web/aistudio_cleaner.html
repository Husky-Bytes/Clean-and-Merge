<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Studio Cleaner, Merger, and Story Chat</title>
  <style>
    :root {
      --bg: #f7f9fc;
      --card: #ffffff;
      --text: #172033;
      --muted: #5f6b85;
      --primary: #1f6feb;
      --primary-hover: #195ec7;
      --secondary: #eef2fa;
      --secondary-text: #1f355f;
      --success-bg: #e8f8ef;
      --success-text: #0e5c2f;
      --error-bg: #fdecec;
      --error-text: #8e1f1f;
      --info-bg: #eaf2ff;
      --info-text: #12396f;
      --border: #dce4f3;
      --chat-user-bg: #eaf2ff;
      --chat-ai-bg: #f1f8ee;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(160deg, #f7f9fc 0%, #eef3ff 100%);
      color: var(--text);
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 20px;
    }

    main {
      width: 100%;
      max-width: 960px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
      box-shadow: 0 10px 28px rgba(20, 35, 71, 0.08);
    }

    h1 {
      margin: 0 0 8px;
      font-size: 1.7rem;
    }

    p {
      margin: 0;
      color: var(--muted);
      line-height: 1.5;
    }

    .panel {
      margin-top: 22px;
      padding: 16px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #fbfdff;
    }

    .panel-title {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
    }

    .panel-desc {
      margin-top: 6px;
      color: var(--muted);
      font-size: 0.93rem;
      line-height: 1.45;
    }

    .controls {
      margin-top: 14px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .file-stack {
      margin-top: 14px;
      display: grid;
      gap: 12px;
    }

    .field-label {
      display: block;
      margin-bottom: 6px;
      font-size: 0.9rem;
      color: var(--muted);
    }

    input[type="file"] {
      width: 100%;
      font-size: 0.96rem;
      color: var(--text);
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
    }

    button {
      border: 0;
      border-radius: 10px;
      background: var(--primary);
      color: white;
      font-weight: 600;
      font-size: 0.95rem;
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.15s ease;
    }

    button:hover:not(:disabled) {
      background: var(--primary-hover);
    }

    button.secondary {
      background: var(--secondary);
      color: var(--secondary-text);
    }

    button.secondary:hover:not(:disabled) {
      background: #dde6f6;
    }

    button:disabled {
      cursor: not-allowed;
      opacity: 0.55;
    }

    .file-name {
      margin-top: 10px;
      font-size: 0.92rem;
      color: var(--muted);
      word-break: break-all;
    }

    .status {
      margin-top: 16px;
      border-radius: 10px;
      padding: 11px 12px;
      font-size: 0.95rem;
      line-height: 1.4;
      border: 1px solid transparent;
      display: none;
    }

    .status[data-tone="info"] {
      display: block;
      background: var(--info-bg);
      border-color: #cfe0ff;
      color: var(--info-text);
    }

    .status[data-tone="success"] {
      display: block;
      background: var(--success-bg);
      border-color: #c9efd8;
      color: var(--success-text);
    }

    .status[data-tone="error"] {
      display: block;
      background: var(--error-bg);
      border-color: #f4cccc;
      color: var(--error-text);
    }

    .guide {
      margin-top: 18px;
      font-size: 0.9rem;
      color: var(--muted);
      line-height: 1.5;
    }

    .guide code {
      background: #eef3ff;
      border: 1px solid #dce5ff;
      border-radius: 6px;
      padding: 0 6px;
    }

    input[type="text"],
    select,
    textarea {
      width: 100%;
      font-size: 0.96rem;
      color: var(--text);
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      font-family: inherit;
    }

    textarea {
      min-height: 96px;
      resize: vertical;
      line-height: 1.4;
    }

    .auth-row {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 10px;
    }

    .auth-info {
      font-size: 0.9rem;
      color: var(--muted);
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #fff;
    }

    .inline-field {
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 0.92rem;
    }

    .inline-field select {
      width: auto;
      min-width: 180px;
      padding: 8px;
    }

    .inline-check {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--muted);
      font-size: 0.92rem;
    }

    .inline-check input {
      width: auto;
    }

    .context-banner {
      margin-top: 12px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #fff;
      color: var(--muted);
      font-size: 0.92rem;
      line-height: 1.4;
    }

    .context-banner[data-tone="info"] {
      background: var(--info-bg);
      border-color: #cfe0ff;
      color: var(--info-text);
    }

    .context-banner[data-tone="success"] {
      background: var(--success-bg);
      border-color: #c9efd8;
      color: var(--success-text);
    }

    .context-banner[data-tone="error"] {
      background: var(--error-bg);
      border-color: #f4cccc;
      color: var(--error-text);
    }

    .chat-box {
      margin-top: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #fff;
      min-height: 180px;
      max-height: 420px;
      overflow-y: auto;
      padding: 12px;
      display: grid;
      gap: 10px;
    }

    .chat-empty {
      color: var(--muted);
      font-size: 0.92rem;
      line-height: 1.45;
      border: 1px dashed var(--border);
      border-radius: 8px;
      padding: 10px;
      background: #fcfdff;
    }

    .chat-message {
      border-radius: 10px;
      padding: 10px;
      border: 1px solid var(--border);
      white-space: pre-wrap;
      line-height: 1.45;
      font-size: 0.95rem;
    }

    .chat-message.user {
      background: var(--chat-user-bg);
      border-color: #cfe0ff;
    }

    .chat-message.assistant {
      background: var(--chat-ai-bg);
      border-color: #cfe9c7;
    }

    .chat-head {
      margin-bottom: 6px;
      font-size: 0.8rem;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }

    .chat-actions {
      margin-top: 12px;
      display: grid;
      gap: 10px;
    }

    @media (max-width: 640px) {
      main {
        padding: 20px;
      }

      .inline-field {
        width: 100%;
      }

      .inline-field select {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <main>
    <h1>AI Studio Cleaner, Merger, and Story Chat</h1>
    <p>Clean and merge your files, then chat with AI about the story on the same page.</p>

    <section class="panel">
      <h2 class="panel-title">Clean Mode</h2>
      <p class="panel-desc">AI Studio export file - clean conversation from <code>chunkedPrompt.chunks</code> and download <code>*_Cleaned.txt</code>.</p>

      <div class="controls">
        <input id="cleanFileInput" type="file">
        <button id="cleanConvertBtn" type="button" disabled>Convert to Clean TXT</button>
      </div>
      <div id="cleanSelectedFile" class="file-name">No file selected.</div>
      <div id="cleanStatus" class="status" aria-live="polite"></div>
    </section>

    <section class="panel">
      <h2 class="panel-title">Merge Mode</h2>
      <p class="panel-desc">Input two files in order. Each AI Studio file is cleaned first, plain text stays as-is, then merged as one continuous text and downloaded as <code>*_Merged.txt</code>.</p>

      <div class="file-stack">
        <div>
          <label class="field-label" for="mergeFirstInput">First input file (goes first)</label>
          <input id="mergeFirstInput" type="file">
          <div id="mergeFirstSelected" class="file-name">No first file selected.</div>
        </div>

        <div>
          <label class="field-label" for="mergeSecondInput">Second input file (used for output name)</label>
          <input id="mergeSecondInput" type="file">
          <div id="mergeSecondSelected" class="file-name">No second file selected.</div>
        </div>
      </div>

      <div class="controls">
        <button id="mergeBtn" type="button" disabled>Merge to TXT</button>
      </div>
      <div id="mergeStatus" class="status" aria-live="polite"></div>
    </section>

    <section class="panel">
      <h2 class="panel-title">Story Chat</h2>
      <p class="panel-desc">Talk with AI about your latest Clean/Merge result. Sign in once with Google, choose model, and chat right here.</p>

      <div class="auth-row">
        <div id="authInfo" class="auth-info">Not logged in.</div>
        <button id="googleLoginBtn" type="button">Login with Google</button>
        <div id="googleButtonWrap">
          <div id="googleLoginButton"></div>
        </div>
        <button id="logoutBtn" class="secondary" type="button" disabled>Logout</button>
      </div>

      <div class="controls">
        <label class="inline-field" for="googleClientIdInput">
          Google Client ID
          <input id="googleClientIdInput" type="text" placeholder="xxxxxx.apps.googleusercontent.com">
        </label>
        <button id="saveGoogleClientIdBtn" class="secondary" type="button">Save ID</button>
        <button id="clearGoogleClientIdBtn" class="secondary" type="button">Clear ID</button>
      </div>

      <div class="controls">
        <label class="inline-field" for="modelSelect">
          Model
          <select id="modelSelect"></select>
        </label>
        <label class="inline-check" for="proactiveToggle">
          <input id="proactiveToggle" type="checkbox">
          AI 먼저 말걸기
        </label>
      </div>

      <div id="contextBanner" class="context-banner">먼저 Clean/Merge를 실행해서 문맥을 준비해 주세요.</div>
      <div id="chatMessages" class="chat-box"></div>

      <div class="chat-actions">
        <textarea id="chatInput" placeholder="로그인하고 문맥을 준비하면 여기에 메시지를 입력할 수 있어요." disabled></textarea>
        <div class="controls">
          <button id="chatSendBtn" type="button" disabled>Send</button>
          <button id="clearChatBtn" class="secondary" type="button" disabled>Clear Chat</button>
        </div>
      </div>

      <div id="chatStatus" class="status" aria-live="polite"></div>
    </section>

    <div class="guide">
      Rules:
      <code>[User]</code> / <code>[AI]</code> tags,
      content uses <code>text</code> first then <code>parts[].text</code>,
      merge boundary is one blank line (<code>\n\n</code>),
      merged output name is based on the second file.
    </div>
  </main>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="/web/aistudio_app.js"></script>
  </body>
</html>

